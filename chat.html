<!DOCTYPE html><html>
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Chat</title>
<style>

</style>
<script src="jquery-1.9.1.min.js" ></script>
<script>

var token = "1f9355c9-13cf-47af-bce8-f6a7fd47e160";

function submitChat()
{
    chatmsg=document.getElementById("msg").value;
    document.getElementById("msg").value = "";
    // Use the global user's username
    // http://wingmanapi.herokuapp.com/api/chat/submit
    $.post("http://127.0.0.1:5000/api/chat/submit", {username:"username", chatline: chatmsg, token: token});  
}

function reload() {
    getLastTenLines();
   	setInterval(getLastTenLines, 5000);
}

function getLastTenLines() {
    var request = new XMLHttpRequest();
	request.open("GET", "http://127.0.0.1:5000/api/chat/chatlines?token=" + token, true);
	request.send(null);
	request.onreadystatechange = function(){
		try{
			if (this.readyState ==4 && this.status == 0){
			console.log("status code 0");
			throw "noresponse";
			}
			else if (this.readyState == 4 && this.status == 200){				
				response = (this.responseText);
				parsed_response = JSON.parse(response);
				elem=document.getElementById("chatlines");
                output = "";
            	for (chatline in parsed_response) {

	output = output + "<p>" + parsed_response[chatline].username +": " + parsed_response[chatline].chatline + "</p>\n";
		}
	elem.innerHTML = output;
					}
				}				
	catch(error) {
        if (error == "noresponse") {
            alert("no chat info returned");
        }
    }
}
}

</script>
</head>
<body onload=reload()>
<div id="chatlines">
</div>
<div id="chat" style="position:fixed;top:350px">
<h4>Chat here:</h4><input type="text" placeholder="chat"  id="msg" name="msg" size="80" onchange="submitChat()" />
<input type="submit" value="Submit"/>
</div>
</body>
</html>

 
